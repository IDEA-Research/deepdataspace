"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[734],{30848:function(Le,H,n){n.r(H),n.d(H,{default:function(){return fe}});var q=n(88205),P=n.n(q),p=n(52983),K=n(48815),w={container:"container___l9ot9",left:"left___z70k4",right:"right___JbF7R",modal:"modal___FjMyp"},$=n(4394),_=n(86451),U={"image-options-list":"image-options-list___oaSKK","virtual-list":"virtual-list___au11F","image-options":"image-options___Kuy9B","image-selected":"image-selected___qoFO4"},e=n(97458),ee=function(l){var j=l.images,L=l.selected,y=l.onImageSelected,i=(0,p.useState)(0),E=P()(i,2),R=E[0],u=E[1],C=120,g=(0,p.useCallback)(function(){var f=document.getElementById("image-options-container");if(f){var d=f.offsetHeight||0;u(d-56)}},[]);(0,p.useEffect)(function(){return g(),window.addEventListener("resize",g),function(){window.removeEventListener("resize",g)}},[g]);var N=function(d){d<0||d>=j.length||y(d)};return(0,e.jsx)("div",{id:"image-options-container",className:U["image-options-list"],children:(0,e.jsx)(_.Z,{className:U["virtual-list"],data:j,height:R,fullHeight:!0,itemHeight:C,itemKey:"id",children:function(d,F){var v=F===L?U["image-selected"]:"";return(0,e.jsx)("div",{children:(0,e.jsx)("img",{className:"".concat(U["image-options"]," ").concat(v),src:d.url,onClick:function(){return N(F)}},d.id)})}})})},O=n(58174),te=n(97388),ae=n(34485),z=n.n(ae),ne=n(24454),G=n.n(ne),re=n(56592),oe=n.n(re),ie=n(63879),se=n(59626),Z=n(6590),le=n(73974),ce=n(89894),ue=n(480),X=n(17212),de=n(32030),D=5,V=20,x={categories:"categories___BMpKT","categories-add":"categories-add___EDmRO","categories-add-textarea":"categories-add-textarea___IszF4","categories-add-button":"categories-add-button___MFR7y","categories-current":"categories-current___DghDV","categories-current-list":"categories-current-list___CkCO_","categories-current-list-item":"categories-current-list-item___oTUHZ","categories-current-text":"categories-current-text____g2ks"},J=n(7803),W=n(26237),me=function(l){var j=l.open,L=l.setOpen,y=(0,W.bU)(),i=y.localeText,E=Z.Z.useForm(),R=P()(E,1),u=R[0],C=(0,K.useModel)("Annotator.model"),g=C.images,N=C.categories,f=C.setImages,d=C.setCategories,F=(0,J.x)([]),v=P()(F,2),I=v[0],A=v[1],ve=(0,J.x)(N),Y=P()(ve,2),M=Y[0],b=Y[1];(0,p.useEffect)(function(){u.setFieldValue("fileList",I.map(function(o){return{uid:o.uid,name:o.name,status:"done",url:o.thumbUrl||o.url}}))},[I]),(0,p.useEffect)(function(){b(N)},[j]);var he=function(t,a){if(!a||a.length===0)return Promise.reject(i("annotator.formModal.fileRequiredMsg"));if(a.length>V)return Promise.reject(i("annotator.formModal.fileCountLimitMsg",{count:V}));var r=a.some(function(s){return s.size/1024/1024>D});return r?Promise.reject(i("annotator.formModal.fileSizeLimitMsg",{size:D})):Promise.resolve()},pe=function(){var o=oe()(G()().mark(function t(a){var r,s,h;return G()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(r=a.thumbUrl||a.url,r){m.next=5;break}return m.next=4,new Promise(function(S){var T=new FileReader;T.readAsDataURL(a.originFileObj),T.onload=function(){return S(T.result)}});case 4:r=m.sent;case 5:s=new Image,s.src=r,h=window.open(r),h==null||h.document.write(s.outerHTML);case 9:case"end":return m.stop()}},t)}));return function(a){return o.apply(this,arguments)}}(),xe=function(t){var a=t.map(function(r){return new Promise(function(s,h){var c=new FileReader;c.readAsDataURL(r.originFileObj),c.onload=function(){var m=c.result,S=new Image;S.src=m,S.onload=function(){var T={id:r.uid,url:m,urlFullRes:m,fileName:r.name,width:S.width,height:S.height,objects:[]};f(function(Ze){return[].concat(z()(Ze),[T])}),s()},S.onerror=function(T){h(T)}},c.onerror=function(m){h(m)}})});Promise.all(a).then(function(){}).catch(function(r){console.log(r)})},je=function(t){var a=t.map(function(c){return c.uid}),r=g.map(function(c){return c.id}),s=g.filter(function(c){return a.includes(c.id)&&r.includes(c.id)});f(s);var h=t.filter(function(c){return!r.includes(c.uid)});xe(h)},Ce=function(){return M.length===0?Promise.reject(i("annotator.formModal.categoryRequiredMsg")):Promise.resolve()},Ie=function(t){var a=t.split(`
`).map(function(r){return r.trim()}).filter(Boolean);return a},ye=function(t){var a=z()(M).map(function(s){return s.name}),r=[];t.forEach(function(s){a.includes(s)||(a.push(s),r.push({id:s,name:s}))}),b([].concat(z()(M),r))},Fe=function(){var t=u.getFieldValue("categoryStr"),a=Ie(t);ye(a),u.setFieldValue("categoryStr",""),u.validateFields()},Me=function(t){b(M.filter(function(a){return a.name!==t}))},Se=(0,p.useState)(-1),k=P()(Se,2),Te=k[0],B=k[1],Pe=function(t){return!!g.find(function(a){return a.objects.find(function(r){return r.categoryName===t})})};return(0,e.jsx)(le.Z,{open:j,centered:!0,width:700,title:i("annotator.formModal.title"),onCancel:function(){u.validateFields().then(function(){L(!1)})},onOk:function(){u.validateFields().then(function(t){var a=t.fileList;A(a),je(a),d(M),L(!1)}).catch(function(t){console.log("Validate Failed:",t)})},children:(0,e.jsxs)(Z.Z,{layout:"vertical",form:u,requiredMark:!1,children:[(0,e.jsx)(Z.Z.Item,{style:{margin:"30px 0"},label:(0,e.jsx)("h4",{children:i("annotator.formModal.importImages")}),name:"fileList",valuePropName:"fileList",getValueFromEvent:function(t){return t&&t.fileList},required:!0,rules:[{validator:he}],extra:(0,e.jsx)("p",{children:i("annotator.formModal.imageTips",{count:V,size:D})}),children:(0,e.jsx)(ce.Z,{showUploadList:!0,beforeUpload:function(){return!1},multiple:!0,listType:"picture-card",onPreview:pe,accept:"image/png, image/jpeg, image/jpg",children:(0,e.jsx)(O.ZP,{icon:(0,e.jsx)(ie.Z,{})})})}),(0,e.jsx)(Z.Z.Item,{label:(0,e.jsx)("h4",{children:i("annotator.formModal.categories")}),children:(0,e.jsxs)("div",{className:x.categories,children:[(0,e.jsxs)("div",{className:x["categories-add"],children:[(0,e.jsx)(Z.Z.Item,{name:"categoryStr",initialValue:"",children:(0,e.jsx)(ue.Z.TextArea,{className:x["categories-add-textarea"],rows:6,placeholder:i("annotator.formModal.categoryPlaceholder"),onKeyDown:function(t){return t.stopPropagation()},allowClear:!0,value:u.getFieldValue("categoryStr")})}),(0,e.jsx)(O.ZP,{className:x["categories-add-btn"],onClick:Fe,children:i("annotator.formModal.addCategory")})]}),(0,e.jsxs)("div",{className:x["categories-current"],children:[(0,e.jsx)(Z.Z.Item,{name:"tempCategories",rules:[{validator:Ce}],children:(0,e.jsx)(X.ZP,{className:x["categories-current-list"],bordered:!0,size:"small",dataSource:M,renderItem:function(t,a){return(0,e.jsx)(X.ZP.Item,{className:x["categories-current-list-item"],style:{padding:"2px 16px"},actions:[(0,e.jsx)(de.Z,{overlayStyle:{width:"300px"},title:i("annotator.formModal.deleteCategory.title"),description:i("annotator.formModal.deleteCategory.desc"),open:Te===a,onConfirm:function(){B(-1)},showCancel:!1,children:(0,e.jsx)(O.ZP,{danger:!0,type:"text",icon:(0,e.jsx)(se.Z,{}),onClick:function(){Pe(t.name)?B(a):(Me(t.name),B(-1))}},"delete")},a)],children:t.name},t.id)}})}),(0,e.jsx)("p",{className:x["categories-current-text"],children:"".concat(i("annotator.formModal.categoriesCount"),": ").concat(M.length)})]})]})})]})})},ge=function(){var l=(0,K.useModel)("Annotator.model"),j=l.images,L=l.setImages,y=l.current,i=l.setCurrent,E=l.categories,R=l.setCategories,u=l.exportAnnotations,C=(0,W.bU)(),g=C.localeText,N=(0,p.useState)(!0),f=P()(N,2),d=f[0],F=f[1];return(0,p.useEffect)(function(){var v=function(A){A.preventDefault(),A.returnValue="The current changes will not be saved. Please export before leaving."};return window.addEventListener("beforeunload",v),function(){window.removeEventListener("beforeunload",v)}},[]),(0,e.jsxs)("div",{className:w.container,children:[(0,e.jsxs)("div",{className:w.left,children:[(0,e.jsx)(O.ZP,{type:"primary",icon:(0,e.jsx)(te.Z,{}),onClick:function(){F(!0)},children:g("annotator.setting")}),(0,e.jsx)(ee,{images:j,selected:y,onImageSelected:function(I){i(I)}})]}),(0,e.jsx)("div",{className:w.right,children:(0,e.jsx)($.Z,{isSeperate:!0,visible:!0,mode:$.j.Edit,categories:E,setCategories:R,list:j,current:y,actionElements:[(0,e.jsx)(O.ZP,{type:"primary",onClick:u,children:g("annotator.export")},"export")],onAutoSave:function(I){L(function(A){A[y].objects=I})}})}),(0,e.jsx)("div",{className:w.modal,children:(0,e.jsx)(me,{open:d,setOpen:F})})]})},fe=ge}}]);

//# sourceMappingURL=p__Annotator__index.e7a8d1d5.async.js.map