"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[69],{63620:function(ue,V,t){t.r(V),t.d(V,{default:function(){return Te}});var H=t(34485),K=t.n(H),Q=t(63900),S=t.n(Q),Y=t(88205),X=t.n(Y),te=t(92183),M=t(23926),Z=t(10130),F=t(61845),z=t(24977),A=t(30956),N=t(32814),re=t(12562),C=t(97375),h=t(35459),O=t(19612),ce=t(9457),J=t(53357),ge=t(47867),W=t(92588),D=t(32694),e=t(35667),pe=function(){var v=(0,C.useModel)("Project.detail"),b=v.pageData,u=v.assignModal,g=v.onCloseAssignModal,x=v.userLintRequest,T=v.assignModalFinish,d=b.projectDetail,L=(0,J.bU)(),a=L.localeText;return d?(0,e.jsxs)(ge.Y,{title:u.types.includes(D.u.reassign)?a("proj.assign.modal.reassign"):a("proj.assign.modal.assign"),width:640,modalProps:{onCancel:g,destroyOnClose:!0,maskClosable:!1},visible:u.show,initialValues:u.initialValues,onFinish:T,children:[u.types.includes(D.u.labelLeader)&&(0,e.jsx)(W.Z,{label:a("proj.assign.modal.ll.label"),placeholder:a("proj.assign.modal.ll.placeholder"),tooltip:a("proj.assign.modal.ll.tooltip"),name:"labelLeaderId",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:x,rules:[{required:!0,message:a("proj.assign.modal.ll.msg")}]}),u.types.includes(D.u.reviewLeader)&&(0,e.jsx)(W.Z,{label:a("proj.assign.modal.rl.label"),placeholder:a("proj.assign.modal.rl.placeholder"),tooltip:a("proj.assign.modal.rl.tooltip"),name:"reviewLeaderId",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:x,rules:[{required:!0,message:a("proj.assign.modal.rl.msg")}]}),u.types.includes(D.u.labeler)&&(0,e.jsx)(W.Z.SearchSelect,{label:a("proj.assign.modal.ler.label"),placeholder:a("proj.assign.modal.ler.placeholder",{times:d.labelTimes}),tooltip:a("proj.assign.modal.ler.tootltip"),name:"labelerIds",fieldProps:{mode:"multiple",labelInValue:!1},debounceTime:300,request:x,rules:[{required:!0,message:a("proj.assign.modal.ler.msg",{times:d.labelTimes})},{len:d.labelTimes,transform:function(s){return s.length?"s".repeat(s.length):""},message:a("proj.assign.modal.ler.msgTimes",{times:d.labelTimes})}]}),u.types.includes(D.u.reviewer)&&(0,e.jsx)(W.Z.SearchSelect,{label:a("proj.assign.modal.rer.label"),placeholder:a("proj.assign.modal.rer.placeholder",{times:d.reviewTimes}),tooltip:a("proj.assign.modal.rer.tootltip"),name:"reviewerIds",fieldProps:{mode:"multiple",labelInValue:!1},debounceTime:300,request:x,rules:[{required:!0,message:a("proj.assign.modal.rer.msg",{times:d.reviewTimes})},{len:d.reviewTimes,transform:function(s){return s.length?"s".repeat(s.length):""},message:a("proj.assign.modal.rer.msgTimes",{times:d.reviewTimes})}]}),u.types.includes(D.u.reassign)&&(0,e.jsx)(W.Z,{label:a("proj.assign.modal.reassign.label"),placeholder:a("proj.assign.modal.reassign.placeholder"),name:"reassigner",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:x,rules:[{required:!0,message:a("proj.assign.modal.reassign.msg")}]})]}):null},ve=pe,me=t(62109),le=t(58757),f=t(1239),U={container:"container___SbJNH",progress:"progress___E0MmQ",progressItem:"progressItem___NiZAB",labels:"labels___TBmcS",split:"split___NOm1V"},je=function(v){var b=v.data,u=(0,J.bU)(),g=u.localeText;if(!b)return(0,e.jsx)(e.Fragment,{children:"-"});var x=b.labelNumWaiting,T=b.reviewNumWaiting,d=b.reviewNumRejected,L=b.reviewNumAccepted,a=x+T+d+L,m=[{label:g("proj.taskProgress.done"),color:"#72c240",progressColor:"#72c240",value:L},{label:g("proj.taskProgress.inRework"),color:"#ec5b56",progressColor:"#ec5b56",value:d},{label:g("proj.taskProgress.toReview"),color:"#448ef7",progressColor:"#448ef7",value:T},{label:g("proj.taskProgress.toLabel"),color:"#575252",progressColor:"#e4e4e4",value:x}];return(0,e.jsxs)("div",{className:U.container,children:[(0,e.jsx)("div",{className:U.progress,children:m.map(function(s,I){return(0,e.jsx)("div",{className:U.progressItem,style:{backgroundColor:s.progressColor,width:"".concat(s.value*100/a,"%")}},I)})}),(0,e.jsx)("div",{className:U.labels,children:m.map(function(s,I){return(0,e.jsxs)("div",{style:{color:s.color},children:[I!==0?(0,e.jsx)("span",{className:U.split,children:"|"}):null,(0,e.jsx)("span",{children:s.label}),"(",s.value,")"]},I)})})]})},se=je,he=function(){var v=(0,C.useModel)("Project.auth"),b=v.getUserRoles,u=v.checkPermission,g=(0,C.useModel)("Project.detail"),x=g.taskDetailModalIndex,T=g.setTaskDetailModalIndex,d=g.pageData,L=g.reassignWorker,a=(0,J.bU)(),m=a.localeText,s=x!==void 0?d.list[x]:void 0,I=(0,le.useMemo)(function(){return s?s.labelers.concat(s.reviewers):[]},[s]),q=function(i){var k=[],E=b(d.projectDetail,s);return(u(E,f.Oc.AssignLabeler)&&i.role===f.vb.Labeler||u(E,f.Oc.AssignReviewer)&&i.role===f.vb.Reviewer)&&k.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return L(s,i)},children:m("proj.detail.modal.reassign")},"Reassign")),k},R=[{title:m("proj.detail.modal.index"),valueType:"index",width:80},{title:m("proj.detail.modal.role"),dataIndex:"role"},{title:m("proj.detail.modal.worker"),ellipsis:!0,render:function(i,k){return(0,e.jsx)(O.Z,{isPerson:!0,data:[{text:k.userName}]})}},{title:m("proj.detail.modal.progress"),ellipsis:!0,width:350,render:function(i,k){return(0,e.jsx)(se,{data:k})}},{title:m("proj.detail.modal.action"),valueType:"option",key:"option",render:function(i,k){return q(k)}}];return(0,e.jsx)(me.Z,{title:m("proj.detail.modal.title",{id:s==null?void 0:s.id}),width:1200,open:!!s,onCancel:function(){return T(void 0)},destroyOnClose:!0,footer:null,children:s&&(0,e.jsx)(z.Z,{scroll:{x:800},rowKey:"id",columns:R,cardBordered:!0,dataSource:I,toolBarRender:function(){return[(0,e.jsx)(e.Fragment,{})]},options:!1,search:!1})})},fe=he,be=t(95073),G={page:"page___HrYAe",table:"table___vpXyu",actionCell:"actionCell___NNJhx"},ne=t(23707),xe=function(){var v,b,u,g,x=(0,C.useModel)("user"),T=x.user,d=(0,C.useModel)("Project.auth"),L=d.getUserRoles,a=d.checkPermission,m=(0,le.useState)(!1),s=X()(m,2),I=s[0],q=s[1],R=(0,be.Z)(document.querySelector(".ant-pro-grid-content")),c=(0,C.useModel)("Project.detail"),i=c.pageData,k=c.pageState,E=c.loading,oe=c.onSelectChange,ke=c.onPageChange,we=c.onInitPageState,Ce=c.setTaskDetailModalIndex,ie=c.assignLeaders,Le=c.assignWorker,Ie=c.restartTask,de=c.onChangeTaskResult;(0,ce._)({onInitPageState:we,pageState:k});var De=(0,J.bU)(),o=De.localeText,ye=function(r,l){if(!i.projectDetail)return[];var n=[],j=L(i.projectDetail,r);a(j,f.Oc.AssignLeader)&&n.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return ie([r.id])},children:o("proj.table.detail.action.assignLeader")},"assignLeader"));var y=a(j,f.Oc.AssignLabeler)&&i.projectDetail.labelTimes>0&&r.labelers.length<=0,B=a(j,f.Oc.AssignReviewer)&&i.projectDetail.reviewTimes>0&&r.reviewers.length<=0;if(y||B){var P=[];y&&P.push(D.u.labeler),B&&P.push(D.u.reviewer),n.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return Le(r,P)},children:o("proj.table.detail.action.assignWorker")},"assignWorker"))}(r.labelers.length||r.reviewers.length)&&n.push((0,e.jsx)("a",{onClick:function(){return Ce(l)},children:o("proj.table.detail.action.detail")},"detail")),a(j,f.Oc.RestartTask)&&r.status===h.gZ.Rejected&&n.push((0,e.jsx)("a",{style:{color:"#4fbb30"},onClick:function(){return Ie(r)},children:o("proj.table.detail.action.restart")},"restart")),a(j,f.Oc.TaskQa)&&((r.status===h.gZ.Reviewing||r.status===h.gZ.Rejected)&&n.push((0,e.jsx)("a",{style:{color:"#4fbb30"},onClick:function(){return de(r,r.status===h.gZ.Rejected?h.JE.ForceAccept:h.JE.Accept)},children:o("proj.table.detail.action.accept")},"accept")),r.status===h.gZ.Reviewing&&n.push((0,e.jsx)(A.Z,{title:o("proj.table.detail.action.reject.tips"),onConfirm:function(){return de(r,h.JE.Reject)},children:(0,e.jsx)("a",{style:{color:"red"},children:o("proj.table.detail.action.reject")},"reject")},"reject")));var _=function(Me){var Ze="/project/task/workspace?projectId=".concat((0,ne.Oe)(),"&taskId=").concat(r.id),Ae=S()({taskStatus:r.status},Me);return"".concat(Ze,"&pageState=").concat(encodeURIComponent(JSON.stringify(Ae)))};if(a(j,f.Oc.View)&&n.push((0,e.jsx)(C.Link,{to:_(),children:o("proj.table.detail.action.view")},"view")),a(j,f.Oc.StartLabel)&&r.status===h.gZ.Working){var ee,Re=(ee=r.labelers.find(function(w){return w.userId===T.userId}))===null||ee===void 0?void 0:ee.id;n.push((0,e.jsx)(C.Link,{to:_({status:h.j$.Labeling,roleId:Re}),children:o("proj.table.detail.action.startLabel")},"StartLabel"))}if(a(j,f.Oc.StartReview)&&r.status===h.gZ.Working){var ae,Se=(ae=r.reviewers.find(function(w){return w.userId===T.userId}))===null||ae===void 0?void 0:ae.id;n.push((0,e.jsx)(C.Link,{to:_({status:h.j$.Reviewing,roleId:Se}),children:o("proj.table.detail.action.startReview")},"StartReview"))}return n},Pe=[{title:o("proj.table.detail.index"),valueType:"index",width:80,render:function(r,l){return l.idx+1}},{title:o("proj.table.detail.labelLeader"),ellipsis:!0,width:200,render:function(r,l){return l.labelLeader?(0,e.jsx)(O.Z,{isPerson:!0,data:[{text:l.labelLeader.userName,color:"green"}]}):"-"}},{title:o("proj.table.detail.labeler"),dataIndex:"labeler",ellipsis:!0,width:200,render:function(r,l){return l.labelers&&l.labelers.length?(0,e.jsx)(O.Z,{isPerson:!0,data:(l.labelers||[]).map(function(n){return{text:n.userName}})}):"-"}}].concat(K()(i.projectDetail&&i.projectDetail.reviewTimes>0?[{title:o("proj.table.detail.reviewLeader"),ellipsis:!0,width:200,render:function(r,l){return l.reviewLeader?(0,e.jsx)(O.Z,{isPerson:!0,data:[{text:l.reviewLeader.userName,color:"green"}]}):"-"}},{title:o("proj.table.detail.reviewer"),dataIndex:"reviewer",ellipsis:!0,width:200,render:function(r,l){return l.reviewers&&l.reviewers.length?(0,e.jsx)(O.Z,{isPerson:!0,data:(l.reviewers||[]).map(function(n){return{text:n.userName}})}):"-"}}]:[]),[{title:o("proj.table.detail.progress"),dataIndex:"progress",valueType:"progress",ellipsis:!0,width:350,render:function(r,l){var n,j,y=((n=l.labelLeader)===null||n===void 0?void 0:n.userId)!==T.userId&&l.labelers.length===1&&l.labelers[0].userId===T.userId,B=((j=l.reviewLeader)===null||j===void 0?void 0:j.userId)!==T.userId&&l.reviewers.length===1&&l.reviewers[0].userId===T.userId,P=l.labelLeader;return y&&!B?P=l.labelers[0]:B&&!y&&(P=l.reviewers[0]),l.labelers.length>0||l.reviewers.length>0?(0,e.jsx)(se,{data:P}):"-"}},{title:o("proj.table.detail.status"),dataIndex:"status",valueType:"select",ellipsis:!0,width:120,render:function(r,l){if(l.status){var n=h.ZA[l.status],j=n.text,y=n.color;return(0,e.jsx)(N.Z,{color:y,children:o(j)})}}},{title:o("proj.table.detail.action"),valueType:"option",key:"option",width:240,render:function(r,l,n){return(0,e.jsx)("div",{className:G.actionCell,children:ye(l,n)})}}]);return(0,e.jsxs)(F._z,{className:G.page,header:{title:(v=i.projectDetail)===null||v===void 0?void 0:v.name,backIcon:(0,e.jsx)(te.Z,{}),onBack:function(){return(0,ne.yS)("/project")},extra:[(0,e.jsxs)("div",{style:{color:"rgba(0, 0, 0, 0.45)"},children:[o("proj.detail.owner"),":"," ",(b=i.projectDetail)===null||b===void 0?void 0:b.owner.name," |"," ",o("proj.detail.managers"),":"," ",(u=i.projectDetail)===null||u===void 0?void 0:u.managers.map(function(p){return p.name}).join(", ")]},"owner"),(0,e.jsx)(re.ZP,{size:"small",type:"text",icon:I?(0,e.jsx)(M.Z,{}):(0,e.jsx)(Z.Z,{}),onClick:function(){return q(function(r){return!r})}},"icon")],breadcrumb:{}},content:I?null:(g=i.projectDetail)===null||g===void 0?void 0:g.description,children:[(0,e.jsx)(z.Z,{rowKey:"id",className:G.table,scroll:{x:1200,y:R!=null&&R.height?R.height-124:void 0},columns:Pe,cardBordered:!0,dataSource:i.list,toolBarRender:function(){return[(0,e.jsx)(e.Fragment,{})]},options:!1,search:!1,rowSelection:a(L(i.projectDetail),f.Oc.AssignLeader)?{getCheckboxProps:function(r){return{disabled:!!(r.labelLeader||r.reviewLeader)}},selectedRowKeys:i.selectedTaskIds,onChange:oe}:!1,tableAlertOptionRender:function(){return(0,e.jsxs)(re.ZP,{type:"primary",onClick:function(){return ie()},children:["+ ",o("proj.table.detail.batchAssignLeader")]})},loading:E,pagination:{current:k.page,pageSize:k.pageSize,total:i.total,showSizeChanger:!0,onChange:ke}}),(0,e.jsx)(fe,{}),(0,e.jsx)(ve,{})]})},Te=xe},19612:function(ue,V,t){t.d(V,{Z:function(){return X}});var H=t(81029),K=t(32814),Q={tagsWrap:"tagsWrap___bmrPM"},S=t(35667),Y=function(M){var Z=M.data,F=M.max,z=M.isPerson,A=F?Z.slice(0,F):Z;return(0,S.jsxs)("div",{className:Q.tagsWrap,children:[A&&A.map(function(N){return(0,S.jsx)(K.Z,{icon:z?(0,S.jsx)(H.Z,{}):null,color:N.color||"geekblue",children:N.text},N.text)}),A.length<Z.length?"...":""]})},X=Y}}]);
