"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[734],{61763:function(Ee,b,n){n.r(b),n.d(b,{default:function(){return pe}});var k=n(88205),Z=n.n(k),h=n(52983),K=n(52994),w={container:"container___l9ot9",left:"left___z70k4",right:"right___JbF7R",modal:"modal___FjMyp"},q=n(51297),_=n(74004),ee=n(35115),D={"image-options-list":"image-options-list___oaSKK","virtual-list":"virtual-list___au11F","image-options":"image-options___Kuy9B","image-selected":"image-selected___qoFO4"},e=n(97458),te=function(u){var I=u.images,y=u.selected,S=u.onImageSelected,s=(0,h.useState)(0),N=Z()(s,2),E=N[0],m=N[1],C=120,v=(0,h.useCallback)(function(){var p=document.getElementById("image-options-container");if(p){var g=p.offsetHeight||0;m(g-56)}},[]);(0,h.useEffect)(function(){return v(),window.addEventListener("resize",v),function(){window.removeEventListener("resize",v)}},[v]);var A=function(g){g<0||g>=I.length||S(g)};return(0,e.jsx)("div",{id:"image-options-container",className:D["image-options-list"],children:(0,e.jsx)(ee.Z,{className:D["virtual-list"],data:I,height:E,fullHeight:!0,itemHeight:C,itemKey:"id",children:function(g,M){var l=M===y?D["image-selected"]:"";return(0,e.jsx)("div",{children:(0,e.jsx)("img",{className:"".concat(D["image-options"]," ").concat(l),src:g.url,onClick:function(){return A(M)}},g.id)})}})})},U=n(58174),ae=n(97388),ne=n(34485),R=n.n(ne),re=n(24454),J=n.n(re),oe=n(56592),ie=n.n(oe),se=n(63879),le=n(59626),L=n(6590),ce=n(73974),ue=n(39487),de=n(89894),me=n(480),$=n(17212),ge=n(32030),z=5,V=20,j={categories:"categories___BMpKT","categories-add":"categories-add___EDmRO","categories-add-textarea":"categories-add-textarea___IszF4","categories-add-button":"categories-add-button___MFR7y","categories-current":"categories-current___DghDV","categories-current-list":"categories-current-list___CkCO_","categories-current-list-item":"categories-current-list-item___oTUHZ","categories-current-text":"categories-current-text____g2ks"},G=n(7803),X=n(7818),fe=function(u){var I=u.open,y=u.setOpen,S=(0,X.bU)(),s=S.localeText,N=L.Z.useForm(),E=Z()(N,1),m=E[0],C=(0,K.useModel)("Annotator.model"),v=C.images,A=C.categories,p=C.setImages,g=C.setCategories,M=(0,G.x)([]),l=Z()(M,2),i=l[0],O=l[1],he=(0,G.x)(A),Q=Z()(he,2),F=Q[0],B=Q[1];(0,h.useEffect)(function(){m.setFieldValue("fileList",i.map(function(o){return{uid:o.uid,name:o.name,status:"done",url:o.thumbUrl||o.url}}))},[i]),(0,h.useEffect)(function(){B(A)},[I]);var xe=function(t,a){if(!a||a.length===0)return Promise.reject(s("annotator.formModal.fileRequiredMsg"));if(a.length>V)return Promise.reject(s("annotator.formModal.fileCountLimitMsg",{count:V}));var r=a.some(function(c){return c.size/1024/1024>z});return r?Promise.reject(s("annotator.formModal.fileSizeLimitMsg",{size:z})):Promise.resolve()},je=function(){var o=ie()(J()().mark(function t(a){var r,c,x;return J()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(r=a.thumbUrl||a.url,r){f.next=5;break}return f.next=4,new Promise(function(P){var T=new FileReader;T.readAsDataURL(a.originFileObj),T.onload=function(){return P(T.result)}});case 4:r=f.sent;case 5:c=new Image,c.src=r,x=window.open(r),x==null||x.document.write(c.outerHTML);case 9:case"end":return f.stop()}},t)}));return function(a){return o.apply(this,arguments)}}(),Ie=function(t){var a=t.map(function(r){return new Promise(function(c,x){var d=new FileReader;d.readAsDataURL(r.originFileObj),d.onload=function(){var f=d.result,P=new Image;P.src=f,P.onload=function(){var T={id:r.uid,url:f,urlFullRes:f,fileName:r.name,width:P.width,height:P.height,objects:[]};p(function(Ne){return[].concat(R()(Ne),[T])}),c()},P.onerror=function(T){x(T)}},d.onerror=function(f){x(f)}})});Promise.all(a).then(function(){}).catch(function(r){console.log(r)})},Ce=function(t){var a=t.map(function(d){return d.uid}),r=v.map(function(d){return d.id}),c=v.filter(function(d){return a.includes(d.id)&&r.includes(d.id)});p(c);var x=t.filter(function(d){return!r.includes(d.uid)});Ie(x)},Me=function(){return F.length===0?Promise.reject(s("annotator.formModal.categoryRequiredMsg")):Promise.resolve()},ye=function(t){var a=t.split(`
`).map(function(r){return r.trim()}).filter(Boolean);return a},Se=function(t){var a=R()(F).map(function(c){return c.name}),r=[];t.forEach(function(c){a.includes(c)||(a.push(c),r.push({id:c,name:c}))}),B([].concat(R()(F),r))},Fe=function(){var t=m.getFieldValue("categoryStr"),a=ye(t);Se(a),m.setFieldValue("categoryStr",""),m.validateFields()},Pe=function(t){B(F.filter(function(a){return a.name!==t}))},Te=(0,h.useState)(-1),Y=Z()(Te,2),Ze=Y[0],H=Y[1],Le=function(t){return!!v.find(function(a){return a.objects.find(function(r){return r.categoryName===t})})};return(0,e.jsxs)(ce.Z,{open:I,centered:!0,width:700,title:s("annotator.formModal.title"),onCancel:function(){m.validateFields().then(function(){y(!1)})},onOk:function(){m.validateFields().then(function(t){var a=t.fileList;O(a),Ce(a),g(F),y(!1)}).catch(function(t){console.log("Validate Failed:",t)})},children:[(0,e.jsx)(ue.Z,{message:s("annotator.notice"),type:"info",showIcon:!0,style:{margin:"20px 0"}}),(0,e.jsxs)(L.Z,{layout:"vertical",form:m,requiredMark:!1,children:[(0,e.jsx)(L.Z.Item,{style:{marginBottom:"30px"},label:(0,e.jsx)("h4",{children:s("annotator.formModal.importImages")}),name:"fileList",valuePropName:"fileList",getValueFromEvent:function(t){return t&&t.fileList},required:!0,rules:[{validator:xe}],extra:(0,e.jsx)("p",{children:s("annotator.formModal.imageTips",{count:V,size:z})}),children:(0,e.jsx)(de.Z,{showUploadList:!0,beforeUpload:function(){return!1},multiple:!0,listType:"picture-card",onPreview:je,accept:"image/png, image/jpeg, image/jpg",children:(0,e.jsx)(U.ZP,{icon:(0,e.jsx)(se.Z,{})})})}),(0,e.jsx)(L.Z.Item,{label:(0,e.jsx)("h4",{children:s("annotator.formModal.categories")}),children:(0,e.jsxs)("div",{className:j.categories,children:[(0,e.jsxs)("div",{className:j["categories-add"],children:[(0,e.jsx)(L.Z.Item,{name:"categoryStr",initialValue:"",children:(0,e.jsx)(me.Z.TextArea,{className:j["categories-add-textarea"],rows:6,placeholder:s("annotator.formModal.categoryPlaceholder"),onKeyDown:function(t){return t.stopPropagation()},allowClear:!0,value:m.getFieldValue("categoryStr")})}),(0,e.jsx)(U.ZP,{className:j["categories-add-btn"],onClick:Fe,children:s("annotator.formModal.addCategory")})]}),(0,e.jsxs)("div",{className:j["categories-current"],children:[(0,e.jsx)(L.Z.Item,{name:"tempCategories",rules:[{validator:Me}],children:(0,e.jsx)($.ZP,{className:j["categories-current-list"],bordered:!0,size:"small",dataSource:F,renderItem:function(t,a){return(0,e.jsx)($.ZP.Item,{className:j["categories-current-list-item"],style:{padding:"2px 16px"},actions:[(0,e.jsx)(ge.Z,{overlayStyle:{width:"300px"},title:s("annotator.formModal.deleteCategory.title"),description:s("annotator.formModal.deleteCategory.desc"),open:Ze===a,onConfirm:function(){H(-1)},showCancel:!1,children:(0,e.jsx)(U.ZP,{danger:!0,type:"text",icon:(0,e.jsx)(le.Z,{}),onClick:function(){Le(t.name)?H(a):(Pe(t.name),H(-1))}},"delete")},a)],children:t.name},t.id)}})}),(0,e.jsx)("p",{className:j["categories-current-text"],children:"".concat(s("annotator.formModal.categoriesCount"),": ").concat(F.length)})]})]})})]})]})},ve=function(){var u=(0,K.useModel)("Annotator.model"),I=u.images,y=u.setImages,S=u.current,s=u.setCurrent,N=u.categories,E=u.setCategories,m=u.exportAnnotations,C=(0,X.bU)(),v=C.localeText,A=(0,h.useState)(!0),p=Z()(A,2),g=p[0],M=p[1];return(0,h.useEffect)(function(){var l=function(O){O.preventDefault(),O.returnValue="The current changes will not be saved. Please export before leaving."};return window.addEventListener("beforeunload",l),function(){window.removeEventListener("beforeunload",l)}},[]),(0,h.useEffect)(function(){var l=localStorage.getItem("images"),i=localStorage.getItem("categories");l&&i&&(y(JSON.parse(l)),E(JSON.parse(i)),M(!1))},[]),(0,e.jsxs)("div",{className:w.container,children:[(0,e.jsxs)("div",{className:w.left,onMouseDown:function(i){i.stopPropagation()},onMouseUp:function(i){i.stopPropagation()},children:[(0,e.jsx)(U.ZP,{type:"primary",icon:(0,e.jsx)(ae.Z,{}),onClick:function(){M(!0)},children:v("annotator.setting")}),(0,e.jsx)(te,{images:I,selected:S,onImageSelected:function(i){s(i)}})]}),(0,e.jsx)("div",{className:w.right,children:(0,e.jsx)(q.Z,{isSeperate:!0,visible:!0,mode:_.je.Edit,categories:N,setCategories:E,list:I,current:S,actionElements:[(0,e.jsx)(U.ZP,{type:"primary",onClick:m,children:v("annotator.export")},"export")],onAutoSave:function(i){y(function(O){O[S].objects=i})}})}),(0,e.jsx)("div",{className:w.modal,onMouseDown:function(i){return i.stopPropagation()},onMouseUp:function(i){return i.stopPropagation()},children:(0,e.jsx)(fe,{open:g,setOpen:M})})]})},pe=ve}}]);

//# sourceMappingURL=p__Annotator__index.ea974f48.async.js.map