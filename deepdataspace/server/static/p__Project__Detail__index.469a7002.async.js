"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[69],{89398:function(_,R,a){a.d(R,{Z:function(){return J}});var A=a(43659),I=a(52983),E={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},y=E,O=a(31680),Z=function(P,S){return I.createElement(O.Z,(0,A.Z)((0,A.Z)({},P),{},{ref:S,icon:y}))};Z.displayName="ArrowLeftOutlined";var J=I.forwardRef(Z)},94820:function(_,R,a){a.d(R,{Z:function(){return J}});var A=a(63900),I=a.n(A),E=a(88205),y=a.n(E),O=a(52983),Z=a(5451);function J(D){var P=D.pageState,S=D.onInitPageState,B=D.onPageDidMount,N=D.onPageWillUnmount,z=(0,Z.Z)({},{navigateMode:"replace"}),H=y()(z,2),g=H[0],p=H[1];(0,O.useEffect)(function(){if(S){var U={};try{U=g.pageState?JSON.parse(g.pageState):{}}catch(q){console.error("get urlPageState error: ",q)}S(U,g)}return B&&B(g),function(){N&&N()}},[]),(0,O.useEffect)(function(){p(I()(I()({},g),{},{pageState:JSON.stringify(P)}))},[P])}},36094:function(_,R,a){a.r(R),a.d(R,{default:function(){return Te}});var A=a(34485),I=a.n(A),E=a(63900),y=a.n(E),O=a(88205),Z=a.n(O),J=a(89398),D=a(56744),P=a(68505),S=a(40852),B=a(52360),N=a(32030),z=a(13800),H=a(58174),g=a(52994),p=a(23319),U=a(73736),q=a(94820),G=a(7818),ge=a(98887),Q=a(12396),W=a(60566),e=a(97458),pe=function(){var j=(0,g.useModel)("Project.detail"),x=j.pageData,u=j.assignModal,v=j.onCloseAssignModal,T=j.userLintRequest,L=j.assignModalFinish,d=x.projectDetail,M=(0,G.bU)(),t=M.localeText;return d?(0,e.jsxs)(ge.Y,{title:u.types.includes(W.u.reassign)?t("proj.assign.modal.reassign"):t("proj.assign.modal.assign"),width:640,modalProps:{onCancel:v,destroyOnClose:!0,maskClosable:!1},visible:u.show,initialValues:u.initialValues,onFinish:L,children:[u.types.includes(W.u.labelLeader)&&(0,e.jsx)(Q.Z,{label:t("proj.assign.modal.ll.label"),placeholder:t("proj.assign.modal.ll.placeholder"),tooltip:t("proj.assign.modal.ll.tooltip"),name:"labelLeaderId",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.ll.msg")}]}),u.types.includes(W.u.reviewLeader)&&(0,e.jsx)(Q.Z,{label:t("proj.assign.modal.rl.label"),placeholder:t("proj.assign.modal.rl.placeholder"),tooltip:t("proj.assign.modal.rl.tooltip"),name:"reviewLeaderId",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.rl.msg")}]}),u.types.includes(W.u.labeler)&&(0,e.jsx)(Q.Z.SearchSelect,{label:t("proj.assign.modal.ler.label"),placeholder:t("proj.assign.modal.ler.placeholder",{times:d.labelTimes}),tooltip:t("proj.assign.modal.ler.tootltip"),name:"labelerIds",fieldProps:{mode:"multiple",labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.ler.msg",{times:d.labelTimes})},{len:d.labelTimes,transform:function(s){return s.length?"s".repeat(s.length):""},message:t("proj.assign.modal.ler.msgTimes",{times:d.labelTimes})}]}),u.types.includes(W.u.reviewer)&&(0,e.jsx)(Q.Z.SearchSelect,{label:t("proj.assign.modal.rer.label"),placeholder:t("proj.assign.modal.rer.placeholder",{times:d.reviewTimes}),tooltip:t("proj.assign.modal.rer.tootltip"),name:"reviewerIds",fieldProps:{mode:"multiple",labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.rer.msg",{times:d.reviewTimes})},{len:d.reviewTimes,transform:function(s){return s.length?"s".repeat(s.length):""},message:t("proj.assign.modal.rer.msgTimes",{times:d.reviewTimes})}]}),u.types.includes(W.u.reassign)&&(0,e.jsx)(Q.Z,{label:t("proj.assign.modal.reassign.label"),placeholder:t("proj.assign.modal.reassign.placeholder"),name:"reassigner",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.reassign.msg")}]})]}):null},ve=pe,me=a(73974),ne=a(52983),b=a(22689),Y={container:"container___SbJNH",progress:"progress___E0MmQ",progressItem:"progressItem___NiZAB",labels:"labels___TBmcS",split:"split___NOm1V"},je=function(j){var x=j.data,u=(0,G.bU)(),v=u.localeText;if(!x)return(0,e.jsx)(e.Fragment,{children:"-"});var T=x.labelNumWaiting,L=x.reviewNumWaiting,d=x.reviewNumRejected,M=x.reviewNumAccepted,t=T+L+d+M,f=[{label:v("proj.taskProgress.done"),color:"#72c240",progressColor:"#72c240",value:M},{label:v("proj.taskProgress.inRework"),color:"#ec5b56",progressColor:"#ec5b56",value:d},{label:v("proj.taskProgress.toReview"),color:"#448ef7",progressColor:"#448ef7",value:L},{label:v("proj.taskProgress.toLabel"),color:"#575252",progressColor:"#e4e4e4",value:T}];return(0,e.jsxs)("div",{className:Y.container,children:[(0,e.jsx)("div",{className:Y.progress,children:f.map(function(s,k){return(0,e.jsx)("div",{className:Y.progressItem,style:{backgroundColor:s.progressColor,width:"".concat(s.value*100/t,"%")}},k)})}),(0,e.jsx)("div",{className:Y.labels,children:f.map(function(s,k){return(0,e.jsxs)("div",{style:{color:s.color},children:[k!==0?(0,e.jsx)("span",{className:Y.split,children:"|"}):null,(0,e.jsx)("span",{children:s.label}),"(",s.value,")"]},k)})})]})},oe=je,fe=function(){var j=(0,g.useModel)("Project.auth"),x=j.getUserRoles,u=j.checkPermission,v=(0,g.useModel)("Project.detail"),T=v.taskDetailModalIndex,L=v.setTaskDetailModalIndex,d=v.pageData,M=v.reassignWorker,t=(0,G.bU)(),f=t.localeText,s=T!==void 0?d.list[T]:void 0,k=(0,ne.useMemo)(function(){return s?s.labelers.concat(s.reviewers):[]},[s]),te=function(i){var C=[],$=x(d.projectDetail,s);return(u($,b.Oc.AssignLabeler)&&i.role===b.vb.Labeler||u($,b.Oc.AssignReviewer)&&i.role===b.vb.Reviewer)&&C.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return M(s,i)},children:f("proj.detail.modal.reassign")},"Reassign")),C},K=[{title:f("proj.detail.modal.index"),valueType:"index",width:80},{title:f("proj.detail.modal.role"),dataIndex:"role"},{title:f("proj.detail.modal.worker"),ellipsis:!0,render:function(i,C){return(0,e.jsx)(U.Z,{isPerson:!0,data:[{text:C.userName}]})}},{title:f("proj.detail.modal.progress"),ellipsis:!0,width:350,render:function(i,C){return(0,e.jsx)(oe,{data:C})}},{title:f("proj.detail.modal.action"),valueType:"option",key:"option",render:function(i,C){return te(C)}}];return(0,e.jsx)(me.Z,{title:f("proj.detail.modal.title",{id:s==null?void 0:s.id}),width:1200,open:Boolean(s),onCancel:function(){return L(void 0)},destroyOnClose:!0,footer:null,children:s&&(0,e.jsx)(B.Z,{scroll:{x:800},rowKey:"id",columns:K,cardBordered:!0,dataSource:k,toolBarRender:function(){return[(0,e.jsx)(e.Fragment,{})]},options:!1,search:!1})})},he=fe,be=a(19950),ee={page:"page___HrYAe",table:"table___vpXyu",actionCell:"actionCell___NNJhx"},ie=a(42652),xe=function(){var j,x,u,v,T=(0,g.useModel)("user"),L=T.user,d=(0,g.useModel)("Project.auth"),M=d.getUserRoles,t=d.checkPermission,f=(0,ne.useState)(!1),s=Z()(f,2),k=s[0],te=s[1],K=(0,be.Z)(document.querySelector(".ant-pro-grid-content")),c=(0,g.useModel)("Project.detail"),i=c.pageData,C=c.pageState,$=c.loading,de=c.onSelectChange,Le=c.onPageChange,Ce=c.onInitPageState,De=c.setTaskDetailModalIndex,ue=c.assignLeaders,Pe=c.assignWorker,we=c.restartTask,ce=c.onChangeTaskResult;(0,q.Z)({onInitPageState:Ce,pageState:C});var Ie=(0,G.bU)(),o=Ie.localeText,ye=function(r,l){if(!i.projectDetail)return[];var n=[],h=M(i.projectDetail,r);t(h,b.Oc.AssignLeader)&&n.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return ue([r.id])},children:o("proj.table.detail.action.assignLeader")},"assignLeader"));var V=t(h,b.Oc.AssignLabeler)&&i.projectDetail.labelTimes>0&&r.labelers.length<=0,X=t(h,b.Oc.AssignReviewer)&&i.projectDetail.reviewTimes>0&&r.reviewers.length<=0;if(V||X){var F=[];V&&F.push(W.u.labeler),X&&F.push(W.u.reviewer),n.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return Pe(r,F)},children:o("proj.table.detail.action.assignWorker")},"assignWorker"))}(r.labelers.length||r.reviewers.length)&&n.push((0,e.jsx)("a",{onClick:function(){return De(l)},children:o("proj.table.detail.action.detail")},"detail")),t(h,b.Oc.RestartTask)&&r.status===p.gZ.Rejected&&n.push((0,e.jsx)("a",{style:{color:"#4fbb30"},onClick:function(){return we(r)},children:o("proj.table.detail.action.restart")},"restart")),t(h,b.Oc.TaskQa)&&((r.status===p.gZ.Reviewing||r.status===p.gZ.Rejected)&&n.push((0,e.jsx)("a",{style:{color:"#4fbb30"},onClick:function(){return ce(r,r.status===p.gZ.Rejected?p.JE.ForceAccept:p.JE.Accept)},children:o("proj.table.detail.action.accept")},"accept")),r.status===p.gZ.Reviewing&&n.push((0,e.jsx)(N.Z,{title:o("proj.table.detail.action.reject.tips"),onConfirm:function(){return ce(r,p.JE.Reject)},children:(0,e.jsx)("a",{style:{color:"red"},children:o("proj.table.detail.action.reject")},"reject")},"reject")));var re=function(Re){var Ae="/project/task/workspace?projectId=".concat((0,ie.Oe)(),"&taskId=").concat(r.id),Oe=y()({taskStatus:r.status},Re);return"".concat(Ae,"&pageState=").concat(encodeURIComponent(JSON.stringify(Oe)))};if(t(h,b.Oc.View)&&n.push((0,e.jsx)(g.Link,{to:re(),children:o("proj.table.detail.action.view")},"view")),t(h,b.Oc.StartLabel)&&r.status===p.gZ.Working){var le,Me=(le=r.labelers.find(function(w){return w.userId===L.userId}))===null||le===void 0?void 0:le.id;n.push((0,e.jsx)(g.Link,{to:re({status:p.j$.Labeling,roleId:Me}),children:o("proj.table.detail.action.startLabel")},"StartLabel"))}if(t(h,b.Oc.StartReview)&&r.status===p.gZ.Working){var se,ke=(se=r.reviewers.find(function(w){return w.userId===L.userId}))===null||se===void 0?void 0:se.id;n.push((0,e.jsx)(g.Link,{to:re({status:p.j$.Reviewing,roleId:ke}),children:o("proj.table.detail.action.startReview")},"StartReview"))}return n},Se=[{title:o("proj.table.detail.index"),valueType:"index",width:80,render:function(r,l){return l.idx+1}},{title:o("proj.table.detail.labelLeader"),ellipsis:!0,width:200,render:function(r,l){return l.labelLeader?(0,e.jsx)(U.Z,{isPerson:!0,data:[{text:l.labelLeader.userName,color:"green"}]}):"-"}},{title:o("proj.table.detail.labeler"),dataIndex:"labeler",ellipsis:!0,width:200,render:function(r,l){return l.labelers&&l.labelers.length?(0,e.jsx)(U.Z,{isPerson:!0,data:(l.labelers||[]).map(function(n){return{text:n.userName}})}):"-"}}].concat(I()(i.projectDetail&&i.projectDetail.reviewTimes>0?[{title:o("proj.table.detail.reviewLeader"),ellipsis:!0,width:200,render:function(r,l){return l.reviewLeader?(0,e.jsx)(U.Z,{isPerson:!0,data:[{text:l.reviewLeader.userName,color:"green"}]}):"-"}},{title:o("proj.table.detail.reviewer"),dataIndex:"reviewer",ellipsis:!0,width:200,render:function(r,l){return l.reviewers&&l.reviewers.length?(0,e.jsx)(U.Z,{isPerson:!0,data:(l.reviewers||[]).map(function(n){return{text:n.userName}})}):"-"}}]:[]),[{title:o("proj.table.detail.progress"),dataIndex:"progress",valueType:"progress",ellipsis:!0,width:350,render:function(r,l){var n,h,V=((n=l.labelLeader)===null||n===void 0?void 0:n.userId)!==L.userId&&l.labelers.length===1&&l.labelers[0].userId===L.userId,X=((h=l.reviewLeader)===null||h===void 0?void 0:h.userId)!==L.userId&&l.reviewers.length===1&&l.reviewers[0].userId===L.userId,F=l.labelLeader;return V&&!X?F=l.labelers[0]:X&&!V&&(F=l.reviewers[0]),l.labelers.length>0||l.reviewers.length>0?(0,e.jsx)(oe,{data:F}):"-"}},{title:o("proj.table.detail.status"),dataIndex:"status",valueType:"select",ellipsis:!0,width:120,render:function(r,l){if(l.status){var n=p.ZA[l.status],h=n.text,V=n.color;return(0,e.jsx)(z.Z,{color:V,children:o(h)})}}},{title:o("proj.table.detail.action"),valueType:"option",key:"option",width:240,render:function(r,l,n){return(0,e.jsx)("div",{className:ee.actionCell,children:ye(l,n)})}}]);return(0,e.jsxs)(S._z,{className:ee.page,header:{title:(j=i.projectDetail)===null||j===void 0?void 0:j.name,backIcon:(0,e.jsx)(J.Z,{}),onBack:function(){return(0,ie.yS)("/project")},extra:[(0,e.jsxs)("div",{style:{color:"rgba(0, 0, 0, 0.45)"},children:[o("proj.detail.owner"),":"," ",(x=i.projectDetail)===null||x===void 0?void 0:x.owner.name," |"," ",o("proj.detail.managers"),":"," ",(u=i.projectDetail)===null||u===void 0?void 0:u.managers.map(function(m){return m.name}).join(", ")]},"owner"),(0,e.jsx)(H.ZP,{size:"small",type:"text",icon:k?(0,e.jsx)(D.Z,{}):(0,e.jsx)(P.Z,{}),onClick:function(){return te(function(r){return!r})}},"icon")],breadcrumb:{}},content:k?null:(v=i.projectDetail)===null||v===void 0?void 0:v.description,children:[(0,e.jsx)(B.Z,{rowKey:"id",className:ee.table,scroll:{x:1200,y:K!=null&&K.height?K.height-124:void 0},columns:Se,cardBordered:!0,dataSource:i.list,toolBarRender:function(){return[(0,e.jsx)(e.Fragment,{})]},options:!1,search:!1,rowSelection:t(M(i.projectDetail),b.Oc.AssignLeader)?{getCheckboxProps:function(r){return{disabled:Boolean(r.labelLeader||r.reviewLeader)}},selectedRowKeys:i.selectedTaskIds,onChange:de}:!1,tableAlertOptionRender:function(){return(0,e.jsxs)(H.ZP,{type:"primary",onClick:function(){return ue()},children:["+ ",o("proj.table.detail.batchAssignLeader")]})},loading:$,pagination:{current:C.page,pageSize:C.pageSize,total:i.total,showSizeChanger:!0,onChange:Le}}),(0,e.jsx)(he,{}),(0,e.jsx)(ve,{})]})},Te=xe},73736:function(_,R,a){a.d(R,{Z:function(){return Z}});var A=a(41474),I=a(13800),E={tagsWrap:"tagsWrap___bmrPM"},y=a(97458),O=function(D){var P=D.data,S=D.max,B=D.isPerson,N=S?P.slice(0,S):P;return(0,y.jsxs)("div",{className:E.tagsWrap,children:[N&&N.map(function(z){return(0,y.jsx)(I.Z,{icon:B?(0,y.jsx)(A.Z,{}):null,color:z.color||"geekblue",children:z.text},z.text)}),N.length<P.length?"...":""]})},Z=O}}]);
