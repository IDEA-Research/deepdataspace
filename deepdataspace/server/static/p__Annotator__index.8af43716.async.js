"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[734],{30848:function(Le,B,n){n.r(B),n.d(B,{default:function(){return fe}});var q=n(88205),P=n.n(q),h=n(52983),b=n(65343),R={container:"container___l9ot9",left:"left___z70k4",right:"right___JbF7R",modal:"modal___FjMyp"},$=n(27725),_=n(86451),z={"image-options-list":"image-options-list___oaSKK","virtual-list":"virtual-list___au11F","image-options":"image-options___Kuy9B","image-selected":"image-selected___qoFO4"},e=n(97458),ee=function(l){var x=l.images,L=l.selected,C=l.onImageSelected,i=(0,h.useState)(0),N=P()(i,2),O=N[0],u=N[1],j=120,g=(0,h.useCallback)(function(){var f=document.getElementById("image-options-container");if(f){var d=f.offsetHeight||0;u(d-56)}},[]);(0,h.useEffect)(function(){return g(),window.addEventListener("resize",g),function(){window.removeEventListener("resize",g)}},[g]);var A=function(d){d<0||d>=x.length||C(d)};return(0,e.jsx)("div",{id:"image-options-container",className:z["image-options-list"],children:(0,e.jsx)(_.Z,{className:z["virtual-list"],data:x,height:O,fullHeight:!0,itemHeight:j,itemKey:"id",children:function(d,I){var y=I===L?z["image-selected"]:"";return(0,e.jsx)("div",{children:(0,e.jsx)("img",{className:"".concat(z["image-options"]," ").concat(y),src:d.url,onClick:function(){return A(I)}},d.id)})}})})},E=n(58174),te=n(97388),ae=n(34485),U=n.n(ae),ne=n(24454),G=n.n(ne),re=n(56592),oe=n.n(re),ie=n(63879),se=n(59626),Z=n(6590),le=n(73974),ce=n(89894),ue=n(480),X=n(17212),de=n(32030),D=5,V=20,p={categories:"categories___BMpKT","categories-add":"categories-add___EDmRO","categories-add-textarea":"categories-add-textarea___IszF4","categories-add-button":"categories-add-button___MFR7y","categories-current":"categories-current___DghDV","categories-current-list":"categories-current-list___CkCO_","categories-current-list-item":"categories-current-list-item___oTUHZ","categories-current-text":"categories-current-text____g2ks"},J=n(7803),W=n(26237),me=function(l){var x=l.open,L=l.setOpen,C=(0,W.bU)(),i=C.localeText,N=Z.Z.useForm(),O=P()(N,1),u=O[0],j=(0,b.useModel)("Annotator.model"),g=j.images,A=j.categories,f=j.setImages,d=j.setCategories,I=(0,J.x)([]),y=P()(I,2),F=y[0],w=y[1],ve=(0,J.x)(A),Y=P()(ve,2),M=Y[0],H=Y[1];(0,h.useEffect)(function(){u.setFieldValue("fileList",F.map(function(o){return{uid:o.uid,name:o.name,status:"done",url:o.thumbUrl||o.url}}))},[F]),(0,h.useEffect)(function(){H(A)},[x]);var he=function(t,a){if(!a||a.length===0)return Promise.reject(i("annotator.formModal.fileRequiredMsg"));if(a.length>V)return Promise.reject(i("annotator.formModal.fileCountLimitMsg",{count:V}));var r=a.some(function(s){return s.size/1024/1024>D});return r?Promise.reject(i("annotator.formModal.fileSizeLimitMsg",{size:D})):Promise.resolve()},pe=function(){var o=oe()(G()().mark(function t(a){var r,s,v;return G()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(r=a.thumbUrl||a.url,r){m.next=5;break}return m.next=4,new Promise(function(S){var T=new FileReader;T.readAsDataURL(a.originFileObj),T.onload=function(){return S(T.result)}});case 4:r=m.sent;case 5:s=new Image,s.src=r,v=window.open(r),v==null||v.document.write(s.outerHTML);case 9:case"end":return m.stop()}},t)}));return function(a){return o.apply(this,arguments)}}(),xe=function(t){var a=t.map(function(r){return new Promise(function(s,v){var c=new FileReader;c.readAsDataURL(r.originFileObj),c.onload=function(){var m=c.result,S=new Image;S.src=m,S.onload=function(){var T={id:r.uid,url:m,urlFullRes:m,fileName:r.name,width:S.width,height:S.height,objects:[]};f(function(Ze){return[].concat(U()(Ze),[T])}),s()},S.onerror=function(T){v(T)}},c.onerror=function(m){v(m)}})});Promise.all(a).then(function(){}).catch(function(r){console.log(r)})},je=function(t){var a=t.map(function(c){return c.uid}),r=g.map(function(c){return c.id}),s=g.filter(function(c){return a.includes(c.id)&&r.includes(c.id)});f(s);var v=t.filter(function(c){return!r.includes(c.uid)});xe(v)},Ce=function(){return M.length===0?Promise.reject(i("annotator.formModal.categoryRequiredMsg")):Promise.resolve()},Ie=function(t){var a=t.split(`
`).map(function(r){return r.trim()}).filter(Boolean);return a},ye=function(t){var a=U()(M).map(function(s){return s.name}),r=[];t.forEach(function(s){a.includes(s)||(a.push(s),r.push({id:s,name:s}))}),H([].concat(U()(M),r))},Fe=function(){var t=u.getFieldValue("categoryStr"),a=Ie(t);ye(a),u.setFieldValue("categoryStr",""),u.validateFields()},Me=function(t){H(M.filter(function(a){return a.name!==t}))},Se=(0,h.useState)(-1),k=P()(Se,2),Te=k[0],K=k[1],Pe=function(t){return!!g.find(function(a){return a.objects.find(function(r){return r.categoryName===t})})};return(0,e.jsx)(le.Z,{open:x,centered:!0,width:700,title:i("annotator.formModal.title"),onCancel:function(){u.validateFields().then(function(){L(!1)})},onOk:function(){u.validateFields().then(function(t){var a=t.fileList;w(a),je(a),d(M),L(!1)}).catch(function(t){console.log("Validate Failed:",t)})},children:(0,e.jsxs)(Z.Z,{layout:"vertical",form:u,requiredMark:!1,children:[(0,e.jsx)(Z.Z.Item,{style:{margin:"30px 0"},label:(0,e.jsx)("h4",{children:i("annotator.formModal.importImages")}),name:"fileList",valuePropName:"fileList",getValueFromEvent:function(t){return t&&t.fileList},required:!0,rules:[{validator:he}],extra:(0,e.jsx)("p",{children:i("annotator.formModal.imageTips",{count:V,size:D})}),children:(0,e.jsx)(ce.Z,{showUploadList:!0,beforeUpload:function(){return!1},multiple:!0,listType:"picture-card",onPreview:pe,accept:"image/png, image/jpeg, image/jpg",children:(0,e.jsx)(E.ZP,{icon:(0,e.jsx)(ie.Z,{})})})}),(0,e.jsx)(Z.Z.Item,{label:(0,e.jsx)("h4",{children:i("annotator.formModal.categories")}),children:(0,e.jsxs)("div",{className:p.categories,children:[(0,e.jsxs)("div",{className:p["categories-add"],children:[(0,e.jsx)(Z.Z.Item,{name:"categoryStr",initialValue:"",children:(0,e.jsx)(ue.Z.TextArea,{className:p["categories-add-textarea"],rows:6,placeholder:i("annotator.formModal.categoryPlaceholder"),onKeyDown:function(t){return t.stopPropagation()},allowClear:!0,value:u.getFieldValue("categoryStr")})}),(0,e.jsx)(E.ZP,{className:p["categories-add-btn"],onClick:Fe,children:i("annotator.formModal.addCategory")})]}),(0,e.jsxs)("div",{className:p["categories-current"],children:[(0,e.jsx)(Z.Z.Item,{name:"tempCategories",rules:[{validator:Ce}],children:(0,e.jsx)(X.ZP,{className:p["categories-current-list"],bordered:!0,size:"small",dataSource:M,renderItem:function(t,a){return(0,e.jsx)(X.ZP.Item,{className:p["categories-current-list-item"],style:{padding:"2px 16px"},actions:[(0,e.jsx)(de.Z,{overlayStyle:{width:"300px"},title:i("annotator.formModal.deleteCategory.title"),description:i("annotator.formModal.deleteCategory.desc"),open:Te===a,onConfirm:function(){K(-1)},showCancel:!1,children:(0,e.jsx)(E.ZP,{danger:!0,type:"text",icon:(0,e.jsx)(se.Z,{}),onClick:function(){Pe(t.name)?K(a):(Me(t.name),K(-1))}},"delete")},a)],children:t.name},t.id)}})}),(0,e.jsx)("p",{className:p["categories-current-text"],children:"".concat(i("annotator.formModal.categoriesCount"),": ").concat(M.length)})]})]})})]})})},ge=function(){var l=(0,b.useModel)("Annotator.model"),x=l.images,L=l.setImages,C=l.current,i=l.setCurrent,N=l.categories,O=l.setCategories,u=l.exportAnnotations,j=(0,W.bU)(),g=j.localeText,A=(0,h.useState)(!0),f=P()(A,2),d=f[0],I=f[1];return(0,h.useEffect)(function(){},[]),(0,e.jsxs)("div",{className:R.container,children:[(0,e.jsxs)("div",{className:R.left,children:[(0,e.jsx)(E.ZP,{type:"primary",icon:(0,e.jsx)(te.Z,{}),onClick:function(){I(!0)},children:g("annotator.setting")}),(0,e.jsx)(ee,{images:x,selected:C,onImageSelected:function(F){i(F)}})]}),(0,e.jsx)("div",{className:R.right,children:(0,e.jsx)($.Z,{isSeperate:!0,visible:!0,mode:$.j.Edit,categories:N,setCategories:O,list:x,current:C,actionElements:[(0,e.jsx)(E.ZP,{type:"primary",onClick:u,children:g("annotator.export")},"export")],onAutoSave:function(F){L(function(w){w[C].objects=F})}})}),(0,e.jsx)("div",{className:R.modal,children:(0,e.jsx)(me,{open:d,setOpen:I})})]})},fe=ge}}]);

//# sourceMappingURL=p__Annotator__index.8af43716.async.js.map