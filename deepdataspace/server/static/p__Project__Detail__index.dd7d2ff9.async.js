"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[69],{17445:function(se,U,a){a.d(U,{Z:function(){return Q}});var J=a(63900),E=a.n(J),V=a(88205),R=a.n(V),W=a(52983),F=a(85661);function Q(L){var I=L.pageState,O=L.onInitPageState,B=L.onPageDidMount,w=L.onPageWillUnmount,p=(0,F.Z)({},{navigateMode:"replace"}),m=R()(p,2),D=m[0],X=m[1];(0,W.useEffect)(function(){if(O){var A={};try{A=D.pageState?JSON.parse(D.pageState):{}}catch(G){console.error("get urlPageState error: ",G)}O(A,D)}return B&&B(D),function(){w&&w()}},[]),(0,W.useEffect)(function(){X(E()(E()({},D),{},{pageState:JSON.stringify(I)}))},[I])}},91443:function(se,U,a){a.r(U),a.d(U,{default:function(){return be}});var J=a(34485),E=a.n(J),V=a(88205),R=a.n(V),W=a(89398),F=a(56744),Q=a(68505),L=a(18288),I=a(81409),O=a(32030),B=a(13800),w=a(58174),p=a(65343),m=a(29880),D=a(23673),X=a(17445),A=a(26237),G=a(42376),K=a(85791),k=a(60421),e=a(97458),ce=function(){var j=(0,p.useModel)("Project.detail"),x=j.pageData,u=j.assignModal,g=j.onCloseAssignModal,T=j.userLintRequest,C=j.assignModalFinish,d=x.projectDetail,y=(0,A.bU)(),t=y.localeText;return d?(0,e.jsxs)(G.Y,{title:u.types.includes(k.u.reassign)?t("proj.assign.modal.reassign"):t("proj.assign.modal.assign"),width:640,modalProps:{onCancel:g,destroyOnClose:!0,maskClosable:!1},visible:u.show,initialValues:u.initialValues,onFinish:C,children:[u.types.includes(k.u.labelLeader)&&(0,e.jsx)(K.Z,{label:t("proj.assign.modal.ll.label"),placeholder:t("proj.assign.modal.ll.placeholder"),tooltip:t("proj.assign.modal.ll.tooltip"),name:"labelLeaderId",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.ll.msg")}]}),u.types.includes(k.u.reviewLeader)&&(0,e.jsx)(K.Z,{label:t("proj.assign.modal.rl.label"),placeholder:t("proj.assign.modal.rl.placeholder"),tooltip:t("proj.assign.modal.rl.tooltip"),name:"reviewLeaderId",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.rl.msg")}]}),u.types.includes(k.u.labeler)&&(0,e.jsx)(K.Z.SearchSelect,{label:t("proj.assign.modal.ler.label"),placeholder:t("proj.assign.modal.ler.placeholder",{times:d.labelTimes}),tooltip:t("proj.assign.modal.ler.tootltip"),name:"labelerIds",fieldProps:{mode:"multiple",labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.ler.msg",{times:d.labelTimes})},{len:d.labelTimes,transform:function(l){return l.length?"s".repeat(l.length):""},message:t("proj.assign.modal.ler.msgTimes",{times:d.labelTimes})}]}),u.types.includes(k.u.reviewer)&&(0,e.jsx)(K.Z.SearchSelect,{label:t("proj.assign.modal.rer.label"),placeholder:t("proj.assign.modal.rer.placeholder",{times:d.reviewTimes}),tooltip:t("proj.assign.modal.rer.tootltip"),name:"reviewerIds",fieldProps:{mode:"multiple",labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.rer.msg",{times:d.reviewTimes})},{len:d.reviewTimes,transform:function(l){return l.length?"s".repeat(l.length):""},message:t("proj.assign.modal.rer.msgTimes",{times:d.reviewTimes})}]}),u.types.includes(k.u.reassign)&&(0,e.jsx)(K.Z,{label:t("proj.assign.modal.reassign.label"),placeholder:t("proj.assign.modal.reassign.placeholder"),name:"reassigner",fieldProps:{showSearch:!0,labelInValue:!1},debounceTime:300,request:T,rules:[{required:!0,message:t("proj.assign.modal.reassign.msg")}]})]}):null},pe=ce,ge=a(73974),le=a(52983),b=a(73205),z={container:"container___SbJNH",progress:"progress___E0MmQ",progressItem:"progressItem___NiZAB",labels:"labels___TBmcS",split:"split___NOm1V"},ve=function(j){var x=j.data,u=(0,A.bU)(),g=u.localeText;if(!x)return(0,e.jsx)(e.Fragment,{children:"-"});var T=x.labelNumWaiting,C=x.reviewNumWaiting,d=x.reviewNumRejected,y=x.reviewNumAccepted,t=T+C+d+y,h=[{label:g("proj.taskProgress.done"),color:"#72c240",progressColor:"#72c240",value:y},{label:g("proj.taskProgress.inRework"),color:"#ec5b56",progressColor:"#ec5b56",value:d},{label:g("proj.taskProgress.toReview"),color:"#448ef7",progressColor:"#448ef7",value:C},{label:g("proj.taskProgress.toLabel"),color:"#575252",progressColor:"#e4e4e4",value:T}];return(0,e.jsxs)("div",{className:z.container,children:[(0,e.jsx)("div",{className:z.progress,children:h.map(function(l,M){return(0,e.jsx)("div",{className:z.progressItem,style:{backgroundColor:l.progressColor,width:"".concat(l.value*100/t,"%")}},M)})}),(0,e.jsx)("div",{className:z.labels,children:h.map(function(l,M){return(0,e.jsxs)("div",{style:{color:l.color},children:[M!==0?(0,e.jsx)("span",{className:z.split,children:"|"}):null,(0,e.jsx)("span",{children:l.label}),"(",l.value,")"]},M)})})]})},ne=ve,me=function(){var j=(0,p.useModel)("Project.auth"),x=j.getUserRoles,u=j.checkPermission,g=(0,p.useModel)("Project.detail"),T=g.taskDetailModalIndex,C=g.setTaskDetailModalIndex,d=g.pageData,y=g.reassignWorker,t=(0,A.bU)(),h=t.localeText,l=T!==void 0?d.list[T]:void 0,M=(0,le.useMemo)(function(){return l?l.labelers.concat(l.reviewers):[]},[l]),ee=function(i){var P=[],Y=x(d.projectDetail,l);return(u(Y,b.Oc.AssignLabeler)&&i.role===b.vb.Labeler||u(Y,b.Oc.AssignReviewer)&&i.role===b.vb.Reviewer)&&P.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return y(l,i)},children:h("proj.detail.modal.reassign")},"Reassign")),P},_=[{title:h("proj.detail.modal.index"),valueType:"index",width:80},{title:h("proj.detail.modal.role"),dataIndex:"role"},{title:h("proj.detail.modal.worker"),ellipsis:!0,render:function(i,P){return(0,e.jsx)(D.Z,{isPerson:!0,data:[{text:P.userName}]})}},{title:h("proj.detail.modal.progress"),ellipsis:!0,width:350,render:function(i,P){return(0,e.jsx)(ne,{data:P})}},{title:h("proj.detail.modal.action"),valueType:"option",key:"option",render:function(i,P){return ee(P)}}];return(0,e.jsx)(ge.Z,{title:h("proj.detail.modal.title",{id:l==null?void 0:l.id}),width:1200,open:Boolean(l),onCancel:function(){return C(void 0)},destroyOnClose:!0,footer:null,children:l&&(0,e.jsx)(I.Z,{scroll:{x:800},rowKey:"id",columns:_,cardBordered:!0,dataSource:M,toolBarRender:function(){return[(0,e.jsx)(e.Fragment,{})]},options:!1,search:!1})})},je=me,he=a(19950),$={page:"page___HrYAe",table:"table___vpXyu",actionCell:"actionCell___NNJhx"},oe=a(32997),fe=function(){var j,x,u,g,T=(0,p.useModel)("user"),C=T.user,d=(0,p.useModel)("Project.auth"),y=d.getUserRoles,t=d.checkPermission,h=(0,le.useState)(!1),l=R()(h,2),M=l[0],ee=l[1],_=(0,he.Z)(document.querySelector(".ant-pro-grid-content")),c=(0,p.useModel)("Project.detail"),i=c.pageData,P=c.pageState,Y=c.loading,ie=c.onSelectChange,xe=c.onPageChange,Te=c.onInitPageState,Ce=c.setTaskDetailModalIndex,de=c.assignLeaders,Pe=c.assignWorker,De=c.restartTask,ue=c.onChangeTaskResult;(0,X.Z)({onInitPageState:Te,pageState:P});var Le=(0,A.bU)(),o=Le.localeText,Ie=function(s,r){if(!i.projectDetail)return[];var n=[],f=y(i.projectDetail,s);t(f,b.Oc.AssignLeader)&&n.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return de([s.id])},children:o("proj.table.detail.action.assignLeader")},"assignLeader"));var Z=t(f,b.Oc.AssignLabeler)&&i.projectDetail.labelTimes>0&&s.labelers.length<=0,H=t(f,b.Oc.AssignReviewer)&&i.projectDetail.reviewTimes>0&&s.reviewers.length<=0;if(Z||H){var N=[];Z&&N.push(k.u.labeler),H&&N.push(k.u.reviewer),n.push((0,e.jsx)("a",{style:{color:"#2db7f5"},onClick:function(){return Pe(s,N)},children:o("proj.table.detail.action.assignWorker")},"assignWorker"))}(s.labelers.length||s.reviewers.length)&&n.push((0,e.jsx)("a",{onClick:function(){return Ce(r)},children:o("proj.table.detail.action.detail")},"detail")),t(f,b.Oc.RestartTask)&&s.status===m.gZ.Rejected&&n.push((0,e.jsx)("a",{style:{color:"#4fbb30"},onClick:function(){return De(s)},children:o("proj.table.detail.action.restart")},"restart")),t(f,b.Oc.TaskQa)&&((s.status===m.gZ.Reviewing||s.status===m.gZ.Rejected)&&n.push((0,e.jsx)("a",{style:{color:"#4fbb30"},onClick:function(){return ue(s,s.status===m.gZ.Rejected?m.JE.ForceAccept:m.JE.Accept)},children:o("proj.table.detail.action.accept")},"accept")),s.status===m.gZ.Reviewing&&n.push((0,e.jsx)(O.Z,{title:o("proj.table.detail.action.reject.tips"),onConfirm:function(){return ue(s,m.JE.Reject)},children:(0,e.jsx)("a",{style:{color:"red"},children:o("proj.table.detail.action.reject")},"reject")},"reject")));var ae="/project/task/workspace?projectId=".concat((0,oe.Oe)(),"&taskId=").concat(s.id);if(t(f,b.Oc.View)&&n.push((0,e.jsx)(p.Link,{to:ae,children:o("proj.table.detail.action.view")},"view")),t(f,b.Oc.StartLabel)){var te,ye=(te=s.labelers.find(function(S){return S.userId===C.userId}))===null||te===void 0?void 0:te.id,Me=encodeURIComponent(JSON.stringify({status:m.j$.Labeling,roleId:ye}));n.push((0,e.jsx)(p.Link,{to:"".concat(ae,"&pageState=").concat(Me),children:o("proj.table.detail.action.startLabel")},"StartLabel"))}if(t(f,b.Oc.StartReview)){var re,Se=(re=s.reviewers.find(function(S){return S.userId===C.userId}))===null||re===void 0?void 0:re.id,ke=encodeURIComponent(JSON.stringify({status:m.j$.Reviewing,roleId:Se}));n.push((0,e.jsx)(p.Link,{to:"".concat(ae,"&pageState=").concat(ke),children:o("proj.table.detail.action.startReview")},"StartReview"))}return n},we=[{title:o("proj.table.detail.index"),valueType:"index",width:80,render:function(s,r){return r.idx+1}},{title:o("proj.table.detail.labelLeader"),ellipsis:!0,width:200,render:function(s,r){return r.labelLeader?(0,e.jsx)(D.Z,{isPerson:!0,data:[{text:r.labelLeader.userName,color:"green"}]}):"-"}},{title:o("proj.table.detail.labeler"),dataIndex:"labeler",ellipsis:!0,width:200,render:function(s,r){return r.labelers&&r.labelers.length?(0,e.jsx)(D.Z,{isPerson:!0,data:(r.labelers||[]).map(function(n){return{text:n.userName}})}):"-"}}].concat(E()(i.projectDetail&&i.projectDetail.reviewTimes>0?[{title:o("proj.table.detail.reviewLeader"),ellipsis:!0,width:200,render:function(s,r){return r.reviewLeader?(0,e.jsx)(D.Z,{isPerson:!0,data:[{text:r.reviewLeader.userName,color:"green"}]}):"-"}},{title:o("proj.table.detail.reviewer"),dataIndex:"reviewer",ellipsis:!0,width:200,render:function(s,r){return r.reviewers&&r.reviewers.length?(0,e.jsx)(D.Z,{isPerson:!0,data:(r.reviewers||[]).map(function(n){return{text:n.userName}})}):"-"}}]:[]),[{title:o("proj.table.detail.progress"),dataIndex:"progress",valueType:"progress",ellipsis:!0,width:350,render:function(s,r){var n,f,Z=((n=r.labelLeader)===null||n===void 0?void 0:n.userId)!==C.userId&&r.labelers.length===1&&r.labelers[0].userId===C.userId,H=((f=r.reviewLeader)===null||f===void 0?void 0:f.userId)!==C.userId&&r.reviewers.length===1&&r.reviewers[0].userId===C.userId,N=r.labelLeader;return Z&&!H?N=r.labelers[0]:H&&!Z&&(N=r.reviewers[0]),r.labelers.length>0||r.reviewers.length>0?(0,e.jsx)(ne,{data:N}):"-"}},{title:o("proj.table.detail.status"),dataIndex:"status",valueType:"select",ellipsis:!0,width:120,render:function(s,r){if(r.status){var n=m.ZA[r.status],f=n.text,Z=n.color;return(0,e.jsx)(B.Z,{color:Z,children:o(f)})}}},{title:o("proj.table.detail.action"),valueType:"option",key:"option",width:240,render:function(s,r,n){return(0,e.jsx)("div",{className:$.actionCell,children:Ie(r,n)})}}]);return(0,e.jsxs)(L._z,{className:$.page,header:{title:(j=i.projectDetail)===null||j===void 0?void 0:j.name,backIcon:(0,e.jsx)(W.Z,{}),onBack:function(){return(0,oe.yS)("/project")},extra:[(0,e.jsxs)("div",{style:{color:"rgba(0, 0, 0, 0.45)"},children:[o("proj.detail.owner"),":"," ",(x=i.projectDetail)===null||x===void 0?void 0:x.owner.name," |"," ",o("proj.detail.managers"),":"," ",(u=i.projectDetail)===null||u===void 0?void 0:u.managers.map(function(v){return v.name}).join(", ")]},"owner"),(0,e.jsx)(w.ZP,{size:"small",type:"text",icon:M?(0,e.jsx)(F.Z,{}):(0,e.jsx)(Q.Z,{}),onClick:function(){return ee(function(s){return!s})}},"icon")],breadcrumb:{}},content:M?null:(g=i.projectDetail)===null||g===void 0?void 0:g.description,children:[(0,e.jsx)(I.Z,{rowKey:"id",className:$.table,scroll:{x:1200,y:_!=null&&_.height?_.height-124:void 0},columns:we,cardBordered:!0,dataSource:i.list,toolBarRender:function(){return[(0,e.jsx)(e.Fragment,{})]},options:!1,search:!1,rowSelection:t(y(i.projectDetail),b.Oc.AssignLeader)?{getCheckboxProps:function(s){return{disabled:Boolean(s.labelLeader||s.reviewLeader)}},selectedRowKeys:i.selectedTaskIds,onChange:ie}:!1,tableAlertOptionRender:function(){return(0,e.jsxs)(w.ZP,{type:"primary",onClick:function(){return de()},children:["+ ",o("proj.table.detail.batchAssignLeader")]})},loading:Y,pagination:{current:P.page,pageSize:P.pageSize,total:i.total,showSizeChanger:!0,onChange:xe}}),(0,e.jsx)(je,{}),(0,e.jsx)(pe,{})]})},be=fe},23673:function(se,U,a){a.d(U,{Z:function(){return F}});var J=a(41474),E=a(13800),V={tagsWrap:"tagsWrap___bmrPM"},R=a(97458),W=function(L){var I=L.data,O=L.max,B=L.isPerson,w=O?I.slice(0,O):I;return(0,R.jsxs)("div",{className:V.tagsWrap,children:[w&&w.map(function(p){return(0,R.jsx)(E.Z,{icon:B?(0,R.jsx)(J.Z,{}):null,color:p.color||"geekblue",children:p.text},p.text)}),w.length<I.length?"...":""]})},F=W}}]);
